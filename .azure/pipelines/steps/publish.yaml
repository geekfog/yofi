parameters:
# Which runtime to build for. Expected values: win-x64, linux-x64
- name: runtime
  type: string 
  default: 'linux-x64'

steps:
- task: DotNetCoreCLI@2
  displayName: 'Publish web app'
  inputs:
    command: 'publish'
    workingDirectory: $(Solution.MainDirectory)
    publishWebProjects: false
    arguments: '--output $(Solution.PublishDirectory) --configuration Release -r ${{ parameters.runtime }}'
    zipAfterPublish: false
    modifyOutputPath: false

- task: ArchiveFiles@2
  displayName: 'Archive files'
  inputs:
    rootFolderOrFile: $(Solution.PublishDirectory)
    includeRootFolder: false
    archiveType: zip
    archiveFile: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
    replaceExistingArchive: true

- publish: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
  artifact: $(Solution.MainProject)
  